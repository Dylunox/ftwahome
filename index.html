<!DOCTYPE html>
html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="مكتبة الفتوى - منصة المحراب للفتاوى الشرعية والأحكام الإسلامية">
    <meta name="keywords" content="مكتبة الفتوى, فتاوى شرعية, أحكام إسلامية, المحراب">
    <meta name="author" content="فريق المحراب">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#1e3a8a">
    <title>مكتبة الفتوى | المحراب</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.postimg.cc/8CPf69hS/IMG-4113.jpg">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Animate.css for Enhanced Animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        /* Reset Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: #f8fafc;
            color: #1e293b;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        body.dark-mode {
            background: #0f172a;
            color: #e2e8f0;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a, #1e3a8a);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            opacity: 1;
            transition: opacity 0.7s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 40px;
            animation: pulseLogo 2s ease-in-out infinite;
        }

        .loading-logo {
            width: 100%;
            height: 100%;
            border-radius: 25px;
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.5);
            opacity: 0;
            animation: fadeInLogo 1s ease forwards;
        }

        @keyframes pulseLogo {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes fadeInLogo {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .loading-text {
            font-weight: 700;
            font-size: 2.5rem;
            color: #ffffff;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeInText 1s ease 0.5s forwards;
        }

        @keyframes fadeInText {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .loading-progress {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .loading-progress-bar {
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, #b45309, #ffffff);
            animation: progress 2s ease-in-out 0.5s forwards;
        }

        @keyframes progress {
            0% { width: 0; }
            100% { width: 100%; }
        }

        /* Enhanced Gradient Background with Animation */
        .gradient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a8a, #b45309);
            background-size: 400% 400%;
            z-index: -1;
            opacity: 0.3;
            transition: all 0.5s ease-in-out;
            animation: gradientAnimation 15s ease infinite;
        }

        body.dark-mode .gradient-bg {
            background: linear-gradient(135deg, #0f172a, #3b82f6);
            background-size: 400% 400%;
            animation: gradientAnimationDark 15s ease infinite;
        }
        
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes gradientAnimationDark {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Enhanced Navbar with Glass Effect */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(30, 58, 138, 0.85);
            backdrop-filter: blur(15px);
            padding: 15px 30px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        body.dark-mode .navbar {
            background: rgba(15, 23, 42, 0.85);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .navbar .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            display: inline-block;
            overflow: hidden;
        }

        .navbar .logo:hover {
            color: #b45309;
            transform: translateY(-2px);
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .navbar .logo:hover {
            color: #3b82f6;
        }

        /* Navigation Controls */
        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: #b45309;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #92400e;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(180, 83, 9, 0.4);
        }

        body.dark-mode .back-btn {
            background: #3b82f6;
        }

        body.dark-mode .back-btn:hover {
            background: #1d4ed8;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        /* Burger Menu Button */
        .burger-menu {
            background: #b45309;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .burger-menu:hover {
            background: #92400e;
            transform: scale(1.05);
        }

        .burger-menu i {
            font-size: 1.4rem;
            color: #ffffff;
        }

        body.dark-mode .burger-menu {
            background: #3b82f6;
        }

        body.dark-mode .burger-menu:hover {
            background: #1d4ed8;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: #b45309;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .theme-toggle:hover {
            background: #92400e;
        }

        .theme-toggle i {
            font-size: 1.4rem;
            color: #ffffff;
        }

        body.dark-mode .theme-toggle {
            background: #3b82f6;
        }

        body.dark-mode .theme-toggle:hover {
            background: #1d4ed8;
        }

        /* Sidebar Menu */
        .sidebar {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1001;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
        }

        .sidebar.active {
            right: 0;
        }

        body.dark-mode .sidebar {
            background: rgba(15, 23, 42, 0.95);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .sidebar-header {
            border-bottom-color: #334155;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
        }

        body.dark-mode .sidebar-title {
            color: #60a5fa;
        }

        .sidebar-close {
            background: #ef4444;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .sidebar-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #1e293b;
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
        }

        .sidebar-menu-item:hover {
            background: #f8fafc;
            color: #1e3a8a;
            transform: translateX(-5px);
        }

        body.dark-mode .sidebar-menu-item {
            color: #e2e8f0;
            border-bottom-color: #334155;
        }

        body.dark-mode .sidebar-menu-item:hover {
            background: #1e293b;
            color: #60a5fa;
        }

        .sidebar-menu-item i {
            margin-left: 15px;
            font-size: 1.2rem;
            width: 25px;
        }

        .sidebar-menu-item span {
            font-weight: 500;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 40px;
        }

        /* Header Section */
        .header-section {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        body.dark-mode .header-section {
            background: rgba(15, 23, 42, 0.95);
        }

        .header-section h1 {
            font-size: 3rem;
            font-weight: 900;
            color: #1e3a8a;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .header-section h1 {
            color: #60a5fa;
        }

        .header-section p {
            font-size: 1.3rem;
            color: #475569;
            max-width: 600px;
            margin: 0 auto;
        }

        body.dark-mode .header-section p {
            color: #94a3b8;
        }

        /* Search Section */
        .search-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        body.dark-mode .search-section {
            background: rgba(15, 23, 42, 0.95);
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1.1rem;
            background: #ffffff;
            transition: all 0.3s ease;
            outline: none;
        }

        .search-input:focus {
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        body.dark-mode .search-input {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
        }

        body.dark-mode .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1.2rem;
        }

        /* Categories Grid */
        .categories-section {
            margin-bottom: 40px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #1e3a8a, #b45309);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .category-card:hover::before {
            transform: scaleX(1);
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #1e3a8a;
        }

        body.dark-mode .category-card {
            background: rgba(15, 23, 42, 0.95);
        }

        body.dark-mode .category-card:hover {
            border-color: #3b82f6;
        }

        .category-card.active {
            border-color: #1e3a8a;
            background: rgba(30, 58, 138, 0.1);
        }

        body.dark-mode .category-card.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .category-icon {
            font-size: 2.5rem;
            color: #1e3a8a;
            margin-bottom: 15px;
            display: block;
        }

        body.dark-mode .category-icon {
            color: #60a5fa;
        }

        .category-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        body.dark-mode .category-title {
            color: #e2e8f0;
        }

        .category-count {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        body.dark-mode .category-count {
            color: #94a3b8;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #f8fafc;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: relative;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        body.dark-mode .modal-content {
            background: #1e293b;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        body.dark-mode .modal-header {
            border-bottom-color: #334155;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e3a8a;
        }

        body.dark-mode .modal-title {
            color: #60a5fa;
        }

        .modal-close-btn {
            background: #ef4444;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .modal-close-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        /* Question Cards within Modal */
        .modal-question-card {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #b45309;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .modal-question-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .modal-question-card {
            background: #0f172a;
            border-left-color: #3b82f6;
        }

        .modal-question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        body.dark-mode .modal-question-text {
            color: #e2e8f0;
        }

        .modal-answer-text {
            font-size: 1.1rem;
            color: #475569;
            line-height: 1.8;
            display: none;
        }

        .modal-question-card.expanded .modal-answer-text {
            display: block;
        }

        body.dark-mode .modal-answer-text {
            color: #94a3b8;
        }

        .modal-question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #64748b;
        }

        body.dark-mode .modal-question-meta {
            color: #94a3b8;
        }

        .modal-question-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-copy-btn, .modal-share-btn {
            background: transparent;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .modal-copy-btn:hover, .modal-share-btn:hover {
            background: #f1f5f9;
            color: #1e3a8a;
        }

        body.dark-mode .modal-copy-btn:hover, 
        body.dark-mode .modal-share-btn:hover {
            background: #334155;
            color: #60a5fa;
        }

        .modal-expand-icon {
            transition: transform 0.3s ease;
        }

        .modal-question-card.expanded .modal-expand-icon {
            transform: rotate(180deg);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
                margin-top: 80px;
            }

            .navbar {
                padding: 10px 20px;
            }

            .navbar .logo {
                font-size: 2rem;
            }

            .header-section h1 {
                font-size: 2.2rem;
            }

            .categories-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .category-card {
                padding: 20px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .modal-question-text {
                font-size: 1rem;
            }

            .modal-answer-text {
                font-size: 0.9rem;
            }

            .back-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .sidebar {
                width: 300px;
                right: -300px;
            }
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        body.dark-mode .error-message {
            background: #1f1f1f;
            border-color: #dc2626;
            color: #fca5a5;
        }

        /* Scroll to Top Button */
        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #1e3a8a;
            color: #ffffff;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .scroll-top:hover {
            background: #1e40af;
            transform: translateY(-2px);
        }

        .scroll-top.show {
            display: flex;
        }

        body.dark-mode .scroll-top {
            background: #3b82f6;
        }

        body.dark-mode .scroll-top:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-logo-container">
            <img src="https://i.postimg.cc/8CPf69hS/IMG-4113.jpg" alt="المحراب" class="loading-logo">
        </div>
        <div class="loading-text">مكتبة الفتوى</div>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>

    <!-- Gradient Background -->
    <div class="gradient-bg"></div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">أقسام الفتاوى</h3>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu" id="sidebarMenu">
            <!-- Categories will be loaded here dynamically -->
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <a href="#" class="logo">مكتبة الفتوى</a>
        <div class="nav-controls">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-right"></i>
                العودة للرئيسية
            </a>
            <button class="burger-menu" id="burgerMenu">
                <i class="fas fa-bars"></i>
            </button>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <h1>مكتبة الفتوى الشرعية</h1>
            <p>مجموعة شاملة من الفتاوى والأحكام الشرعية المنظمة حسب الموضوعات لتسهيل البحث والوصول للمعلومة الصحيحة</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="ابحث في الفتاوى والأسئلة...">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <!-- Categories Section -->
        <div class="categories-section" id="categoriesSection">
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categories will be loaded here dynamically -->
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="fatwaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalCategoryTitle"></h2>
                <button class="modal-close-btn" id="modalCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalQuestionsContainer">
                <!-- Fatwas for the selected category will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-top" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Global variables
        let fatwasData = [];
        let currentCategory = null;
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Apply saved theme
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }

            // Setup event listeners
            setupEventListeners();

            // Load data
            await loadFatwasData();

            // Hide loading overlay
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 2500);
        }

        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Search functionality
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Burger menu
            document.getElementById('burgerMenu').addEventListener('click', openSidebar);
            document.getElementById('sidebarClose').addEventListener('click', closeSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);

            // Modal close button
            document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
            document.getElementById('fatwaModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeModal();
                }
            });

            // Scroll to top
            document.getElementById('scrollTop').addEventListener('click', scrollToTop);

            // Show/hide scroll to top button
            window.addEventListener('scroll', handleScroll);
        }

        async function loadFatwasData() {
            try {
                // Show loading state
                document.getElementById('categoriesGrid').innerHTML = '<div class="loading-spinner"></div>';

                // In a real implementation, this would fetch from Google Sheets API
                // For now, we'll use the sample data structure based on the Excel file
                fatwasData = await fetchDataFromGoogleSheets();
                
                renderCategories();
                renderSidebarMenu();
            } catch (error) {
                console.error('Error loading data:', error);
                showErrorMessage('حدث خطأ في تحميل البيانات. يرجى المحاولة مرة أخرى.');
            }
        }

        async function fetchDataFromGoogleSheets() {
            try {
                // First, try to fetch from Google Sheets API
                const spreadsheetId = '1fQzzcSdUvYs5A4yKqgVJe_UjjG5i2yGc';
                const sheetsData = await fetchAllSheetsData(spreadsheetId);
                
                if (sheetsData && sheetsData.length > 0) {
                    return sheetsData;
                }
            } catch (error) {
                console.warn('Failed to fetch from Google Sheets API, using fallback data:', error);
            }
            
            // Fallback to structured data based on Excel analysis
            return [
                {
                    category: "الطهارات",
                    icon: "fas fa-hand-sparkles",
                    count: 13,
                    questions: [
                        {
                            id: 1,
                            question: "فتوى سؤال (1) السمة لا كل إذا تيمم مه",
                            answer: "الجواب المفصل للسؤال الأول حول الطهارة والتيمم...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "أحكام الحائض والنفساء", 
                    icon: "fas fa-female",
                    count: 27,
                    questions: [
                        {
                            id: 2,
                            question: "ما حكم صلاة المرأة الحائض؟",
                            answer: "لا تصلي المرأة الحائض ولا تصوم، وعليها قضاء الصوم دون الصلاة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الوضوء ونواقضه",
                    icon: "fas fa-tint",
                    count: 43,
                    questions: [
                        {
                            id: 3,
                            question: "ما هي نواقض الوضوء؟",
                            answer: "نواقض الوضوء هي: الخارج من السبيلين، والنوم، ولمس الفرج، والردة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الغسل من الجنابة وأحكامه",
                    icon: "fas fa-shower",
                    count: 15,
                    questions: [
                        {
                            id: 4,
                            question: "متى يجب الغسل من الجنابة؟",
                            answer: "يجب الغسل من الجنابة بعد الجماع أو الإنزال...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "القِبلة واللباس والسترة",
                    icon: "fas fa-compass",
                    count: 18,
                    questions: [
                        {
                            id: 5,
                            question: "ما حكم الصلاة بدون استقبال القبلة؟",
                            answer: "استقبال القبلة شرط من شروط صحة الصلاة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الأوقات",
                    icon: "fas fa-clock",
                    count: 13,
                    questions: [
                        {
                            id: 6,
                            question: "ما هي أوقات الصلوات الخمس؟",
                            answer: "أوقات الصلوات محددة شرعاً: الفجر، الظهر، العصر، المغرب، العشاء...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الأذان والإقامة",
                    icon: "fas fa-mosque",
                    count: 22,
                    questions: [
                        {
                            id: 7,
                            question: "ما حكم الأذان والإقامة؟",
                            answer: "الأذان سنة مؤكدة والإقامة واجبة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "النية والتوجيه",
                    icon: "fas fa-heart",
                    count: 11,
                    questions: [
                        {
                            id: 8,
                            question: "ما حكم النية في الصلاة؟",
                            answer: "النية شرط من شروط صحة الصلاة، ومحلها القلب...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: "بعد مراجعة فضيلة الشيخ ذكر أن القول الراجح عنده في حكم التوجيه أنه سنة مؤكدة."
                        }
                    ]
                },
                {
                    category: "الإستعاذة والقيام للصلاة",
                    icon: "fas fa-praying-hands",
                    count: 5,
                    questions: [
                        {
                            id: 9,
                            question: "هل تشرع الاستعاذة عند القراءة في صلوات السنن والنوافل؟",
                            answer: "ليست الاستعاذة مقصورة على صلاة الفريضة، كما أن القراءة في الصلاة ليست قاصرة على الفرض، والله تعالى يقول: (فَإِذَا قَرَأْتَ الْقُرْآنَ فَاسْتَعِذْ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ) فالآية تبين مشروعية الاستعاذة عند كل قراءة في صلاة أو غيرها.",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "القراءة",
                    icon: "fas fa-book-open",
                    count: 18,
                    questions: [
                        {
                            id: 10,
                            question: "هل يجوز التنكيس في قراءة القرآن في الصلاة؟",
                            answer: "الأولى في قراءة الصلاة أن يلتزم فيها المصلي إماماً كان أو منفرداً الترتيب المصحفي، بحيث لا يقرأ في الركعة الأولى من أواخر القرآن ثم يقرأ في الثانية من أوله أو وسطه، وإنما قلت إن ذلك هو الأولى للخروج من الخلاف والعمل بالمجمع عليه، وإن كان جواز خلافه هو الأصح.",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        },
                        {
                            id: 11,
                            question: "هل هناك آيات من القرآن الكريم ورد فيها نهي عن قراءتها في الصلاة؟",
                            answer: "لا يمنع من قراءة شيء من القرآن في الصلاة، لعموم قوله تعالى: (فَاقْرَءُوا مَا تَيَسَّرَ مِنْهُ) وهذا مما لا خلاف فيه.",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الركوع والسجود",
                    icon: "fas fa-hands-praying",
                    count: 25,
                    questions: [
                        {
                            id: 12,
                            question: "ما حكم من نسي الركوع في الصلاة؟",
                            answer: "من نسي الركوع في الصلاة، فإن تذكره قبل السجود أتى به، وإن تذكره بعد السجود بطلت الركعة وعليه الإتيان بركعة بدلها...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "السهو في الصلاة",
                    icon: "fas fa-undo",
                    count: 10,
                    questions: [
                        {
                            id: 13,
                            question: "ماذا يفعل من سها في صلاته؟",
                            answer: "من سها في صلاته فعليه سجود السهو بعد السلام...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة الجماعة",
                    icon: "fas fa-users",
                    count: 30,
                    questions: [
                        {
                            id: 14,
                            question: "ما فضل صلاة الجماعة؟",
                            answer: "صلاة الجماعة أفضل من صلاة الفذ بسبع وعشرين درجة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة الجمعة",
                    icon: "fas fa-calendar-alt",
                    count: 12,
                    questions: [
                        {
                            id: 15,
                            question: "على من تجب صلاة الجمعة؟",
                            answer: "تجب صلاة الجمعة على كل مسلم ذكر، حر، بالغ، مقيم، غير معذور...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة المسافر",
                    icon: "fas fa-plane",
                    count: 8,
                    questions: [
                        {
                            id: 16,
                            question: "كيف يصلي المسافر؟",
                            answer: "يجوز للمسافر قصر الصلاة الرباعية وجمع الصلوات...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة المريض",
                    icon: "fas fa-procedures",
                    count: 7,
                    questions: [
                        {
                            id: 17,
                            question: "كيف يصلي المريض؟",
                            answer: "يصلي المريض قائماً إن استطاع، فإن لم يستطع فقاعداً، فإن لم يستطع فعلى جنبه...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة الكسوف والخسوف",
                    icon: "fas fa-cloud-sun",
                    count: 3,
                    questions: [
                        {
                            id: 18,
                            question: "كيف تصلى صلاة الكسوف؟",
                            answer: "صلاة الكسوف ركعتان، في كل ركعة ركوعان...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة الاستسقاء",
                    icon: "fas fa-cloud-showers-heavy",
                    count: 2,
                    questions: [
                        {
                            id: 19,
                            question: "ما هي صلاة الاستسقاء؟",
                            answer: "صلاة الاستسقاء هي صلاة تطلب فيها الأمة من الله السقيا عند الجدب...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة العيدين",
                    icon: "fas fa-moon",
                    count: 6,
                    questions: [
                        {
                            id: 20,
                            question: "كيف تصلى صلاة العيدين؟",
                            answer: "صلاة العيدين ركعتان، يكبر في الأولى سبع تكبيرات وفي الثانية خمس...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "صلاة الجنازة",
                    icon: "fas fa-crosshairs",
                    count: 9,
                    questions: [
                        {
                            id: 21,
                            question: "كيف تصلى صلاة الجنازة؟",
                            answer: "صلاة الجنازة أربع تكبيرات، لا ركوع فيها ولا سجود...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الزكاة",
                    icon: "fas fa-hand-holding-usd",
                    count: 35,
                    questions: [
                        {
                            id: 22,
                            question: "على من تجب الزكاة؟",
                            answer: "تجب الزكاة على كل مسلم ملك نصاباً وحال عليه الحول...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الصيام",
                    icon: "fas fa-moon",
                    count: 40,
                    questions: [
                        {
                            id: 23,
                            question: "ما هي شروط وجوب الصيام؟",
                            answer: "يشترط لوجوب الصيام: الإسلام، العقل، البلوغ، الإقامة، القدرة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الحج والعمرة",
                    icon: "fas fa-kaaba",
                    count: 28,
                    questions: [
                        {
                            id: 24,
                            question: "ما هي أركان الحج؟",
                            answer: "أركان الحج: الإحرام، الوقوف بعرفة، طواف الإفاضة، السعي بين الصفا والمروة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "المعاملات",
                    icon: "fas fa-handshake",
                    count: 50,
                    questions: [
                        {
                            id: 25,
                            question: "ما حكم الربا في الإسلام؟",
                            answer: "الربا محرم في الإسلام بجميع أنواعه...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الأسرة",
                    icon: "fas fa-home",
                    count: 20,
                    questions: [
                        {
                            id: 26,
                            question: "ما هي حقوق الزوجة على زوجها؟",
                            answer: "للزوجة حقوق على زوجها منها: النفقة، المهر، المعاشرة بالمعروف...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الأطعمة والأشربة",
                    icon: "fas fa-utensils",
                    count: 15,
                    questions: [
                        {
                            id: 27,
                            question: "ما حكم أكل لحم الخنزير؟",
                            answer: "يحرم أكل لحم الخنزير في الإسلام...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الأيمان والنذور",
                    icon: "fas fa-gavel",
                    count: 10,
                    questions: [
                        {
                            id: 28,
                            question: "ما هي كفارة اليمين؟",
                            answer: "كفارة اليمين: إطعام عشرة مساكين أو كسوتهم أو تحرير رقبة، فإن لم يجد فصيام ثلاثة أيام...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الحدود والقصاص",
                    icon: "fas fa-balance-scale",
                    count: 5,
                    questions: [
                        {
                            id: 29,
                            question: "ما هي عقوبة السرقة في الإسلام؟",
                            answer: "عقوبة السرقة في الإسلام هي قطع اليد بشروطها...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الجهاد",
                    icon: "fas fa-shield-alt",
                    count: 7,
                    questions: [
                        {
                            id: 30,
                            question: "ما هو الجهاد في سبيل الله؟",
                            answer: "الجهاد في سبيل الله هو بذل الجهد في إعلاء كلمة الله...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "اللباس والزينة",
                    icon: "fas fa-tshirt",
                    count: 14,
                    questions: [
                        {
                            id: 31,
                            question: "ما حكم لبس الحرير للرجال؟",
                            answer: "يحرم لبس الحرير الخالص للرجال في الإسلام...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الطب والتداوي",
                    icon: "fas fa-medkit",
                    count: 8,
                    questions: [
                        {
                            id: 32,
                            question: "ما حكم التداوي بالأعشاب؟",
                            answer: "يجوز التداوي بالأعشاب ما لم تكن ضارة أو محرمة...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "الرؤى والأحلام",
                    icon: "fas fa-cloud",
                    count: 3,
                    questions: [
                        {
                            id: 33,
                            question: "ما حكم تفسير الأحلام في الإسلام؟",
                            answer: "تفسير الأحلام علم شرعي، ولكن لا يجوز الخوض فيه بغير علم...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                },
                {
                    category: "متفرقات",
                    icon: "fas fa-ellipsis-h",
                    count: 20,
                    questions: [
                        {
                            id: 34,
                            question: "ما حكم تهنئة الكفار بأعيادهم؟",
                            answer: "لا يجوز تهنئة الكفار بأعيادهم التي هي من شعائر دينهم...",
                            source: "فتاوى سماحة الشيخ العلامة أحمد بن حمد الخليلي",
                            additional: ""
                        }
                    ]
                }
            ];
        }

        function renderCategories() {
            const categoriesGrid = document.getElementById('categoriesGrid');
            categoriesGrid.innerHTML = '';

            fatwasData.forEach(categoryData => {
                const categoryCard = document.createElement('div');
                categoryCard.classList.add('category-card');
                categoryCard.dataset.category = categoryData.category;
                categoryCard.innerHTML = `
                    <i class="${categoryData.icon} category-icon"></i>
                    <h3 class="category-title">${categoryData.category}</h3>
                    <p class="category-count">${categoryData.count} فتوى</p>
                `;
                categoryCard.addEventListener('click', () => openModal(categoryData.category));
                categoriesGrid.appendChild(categoryCard);
            });
        }

        function renderSidebarMenu() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            sidebarMenu.innerHTML = '';

            fatwasData.forEach(categoryData => {
                const menuItem = document.createElement('div');
                menuItem.classList.add('sidebar-menu-item');
                menuItem.innerHTML = `
                    <i class="${categoryData.icon}"></i>
                    <span>${categoryData.category}</span>
                `;
                menuItem.addEventListener('click', () => {
                    closeSidebar();
                    openModal(categoryData.category);
                });
                sidebarMenu.appendChild(menuItem);
            });
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.getElementById('themeIcon').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('darkMode', isDarkMode);
        }

        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const categoriesGrid = document.getElementById('categoriesGrid');
            categoriesGrid.innerHTML = '';

            const filteredCategories = fatwasData.filter(categoryData => 
                categoryData.category.toLowerCase().includes(searchTerm) ||
                categoryData.questions.some(q => 
                    q.question.toLowerCase().includes(searchTerm) || 
                    q.answer.toLowerCase().includes(searchTerm)
                )
            );

            if (filteredCategories.length === 0) {
                categoriesGrid.innerHTML = '<p style="text-align: center; color: #64748b;">لا توجد نتائج مطابقة لبحثك.</p>';
                if (isDarkMode) {
                    categoriesGrid.querySelector('p').style.color = '#94a3b8';
                }
                return;
            }

            filteredCategories.forEach(categoryData => {
                const categoryCard = document.createElement('div');
                categoryCard.classList.add('category-card');
                categoryCard.dataset.category = categoryData.category;
                categoryCard.innerHTML = `
                    <i class="${categoryData.icon} category-icon"></i>
                    <h3 class="category-title">${categoryData.category}</h3>
                    <p class="category-count">${categoryData.count} فتوى</p>
                `;
                categoryCard.addEventListener('click', () => openModal(categoryData.category));
                categoriesGrid.appendChild(categoryCard);
            });
        }

        function showErrorMessage(message) {
            const mainContainer = document.querySelector('.main-container');
            let errorMessageDiv = document.getElementById('errorMessage');
            if (!errorMessageDiv) {
                errorMessageDiv = document.createElement('div');
                errorMessageDiv.id = 'errorMessage';
                errorMessageDiv.classList.add('error-message');
                mainContainer.prepend(errorMessageDiv);
            }
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleScroll() {
            const scrollTopBtn = document.getElementById('scrollTop');
            if (window.scrollY > 300) {
                scrollTopBtn.classList.add('show');
            } else {
                scrollTopBtn.classList.remove('show');
            }
        }

        // Sidebar Functions
        function openSidebar() {
            document.getElementById('sidebar').classList.add('active');
            document.getElementById('sidebarOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Modal Functions
        function openModal(categoryName) {
            const modal = document.getElementById('fatwaModal');
            const modalTitle = document.getElementById('modalCategoryTitle');
            const modalQuestionsContainer = document.getElementById('modalQuestionsContainer');

            modalTitle.textContent = categoryName;
            modalQuestionsContainer.innerHTML = '';

            const selectedCategory = fatwasData.find(cat => cat.category === categoryName);

            if (selectedCategory && selectedCategory.questions.length > 0) {
                selectedCategory.questions.forEach(q => {
                    const questionCard = document.createElement('div');
                    questionCard.classList.add('modal-question-card');
                    questionCard.innerHTML = `
                        <h3 class="modal-question-text">${q.question} <i class="fas fa-chevron-down modal-expand-icon"></i></h3>
                        <p class="modal-answer-text">${q.answer}</p>
                        <div class="modal-question-meta">
                            <span>المصدر: ${q.source}</span>
                            <div class="modal-question-actions">
                                <button class="modal-copy-btn" data-text="${q.question}\n\n${q.answer}\n\nالمصدر: ${q.source}${q.additional ? '\nمعلومات إضافية: ' + q.additional : ''}">
                                    <i class="fas fa-copy"></i> نسخ
                                </button>
                                <button class="modal-share-btn" data-question="${q.question}" data-answer="${q.answer}">
                                    <i class="fas fa-share-alt"></i> مشاركة
                                </button>
                            </div>
                        </div>
                    `;
                    questionCard.addEventListener('click', function() {
                        this.classList.toggle('expanded');
                    });

                    const copyBtn = questionCard.querySelector('.modal-copy-btn');
                    copyBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        copyToClipboard(this.dataset.text);
                    });

                    const shareBtn = questionCard.querySelector('.modal-share-btn');
                    shareBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        shareFatwa(this.dataset.question, this.dataset.answer);
                    });

                    modalQuestionsContainer.appendChild(questionCard);
                });
            } else {
                modalQuestionsContainer.innerHTML = '<p style="text-align: center; color: #64748b;">لا توجد فتاوى في هذا القسم حالياً.</p>';
                if (isDarkMode) {
                    modalQuestionsContainer.querySelector('p').style.color = '#94a3b8';
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('fatwaModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('تم نسخ الفتوى إلى الحافظة!');
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('فشل في نسخ الفتوى.');
            });
        }

        function shareFatwa(question, answer) {
            if (navigator.share) {
                navigator.share({
                    title: 'فتوى من مكتبة الفتوى',
                    text: `${question}\n\n${answer}`,
                    url: window.location.href
                }).then(() => {
                    console.log('Thanks for sharing!');
                }).catch(console.error);
            } else {
                alert('ميزة المشاركة غير مدعومة في متصفحك. يمكنك نسخ النص يدوياً.');
            }
        }
    </script>
</body>
</html>

